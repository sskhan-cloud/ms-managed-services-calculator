<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Managed Services Calculator – Yotta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f5f6fa;
      color: #222;
    }
    h1 {
      margin-top: 0;
      font-size: 1.6rem;
      color: #283E81; /* Yotta Blue */
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }
    .card-header {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1.05rem;
      color: #283E81;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .left {
      flex: 1 1 340px;
      min-width: 320px;
    }
    .right {
      flex: 1 1 480px;
      min-width: 380px;
    }
    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #555;
    }
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 6px 8px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccd0dd;
      font-size: 0.9rem;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #283E81;
      box-shadow: 0 0 0 1px rgba(40,62,129,0.25);
    }
    input[type="checkbox"] {
      transform: scale(1.0);
      margin-right: 6px;
    }
    .row {
      display: flex;
      gap: 12px;
    }
    .row .col {
      flex: 1;
    }
    .btn {
      display: inline-block;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #283E81; /* Yotta Blue */
      color: #fff;
      font-size: 0.95rem;
      cursor: pointer;
    }
    .btn:hover {
      background: #1d2d5e;
    }
    .btn.secondary {
      background: #6b778c;
    }
    .summary-grid {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    .summary-grid th,
    .summary-grid td {
      padding: 6px 8px;
      border-bottom: 1px solid #e2e4e9;
    }
    .summary-grid th {
      text-align: left;
      background: #f1f3fb;
      font-weight: 600;
      color: #283E81;
    }
    .summary-grid td.label {
      width: 55%;
      color: #444;
    }
    .summary-grid td.value {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #fff;
      background: #283E81;
    }
    .pill.secondary {
      background: #283E81; /* Standard */
    }
    .pill.warning {
      background: #FF7A00; /* Orange accent for DOA */
    }
    .note {
      font-size: 0.75rem;
      color: #666;
      margin-top: 8px;
      white-space: pre-line;
    }
    .toggle-group {
      display: inline-flex;
      border-radius: 999px;
      background: #e1e4f0;
      padding: 2px;
      gap: 2px;
    }
    .toggle-btn {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.8rem;
      border: none;
      background: transparent;
      cursor: pointer;
      color: #283E81;
    }
    .toggle-btn.active {
      background: #283E81;
      color: #fff;
    }

    /* Customer view print mode: only print the customer card */
    @media print {
      body {
        background: #fff;
      }
      .left,
      #internalCard {
        display: none !important;
      }
      #customerCard {
        box-shadow: none !important;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <h1>Managed Services Calculator – Yntraa Cloud</h1>
  <div class="container">
    <!-- INPUTS -->
    <div class="card left">
      <div class="card-header">Inputs</div>

      <label>Customer Name</label>
      <input type="text" id="customerName" placeholder="Customer XYZ" />

      <label>Cloud Type</label>
      <input type="text" id="cloudType" placeholder="Yntraa / AWS / Azure" />

      <div class="row">
        <div class="col">
          <label>Managed Services Plan</label>
          <select id="plan">
            <option value="Foundation">Foundation</option>
            <option value="Prime">Prime</option>
            <option value="Priority">Priority</option>
          </select>
        </div>
        <div class="col">
          <label>DOA Applicable?</label>
          <div>
            <input type="checkbox" id="doaApplicable" checked />
            <span style="font-size:0.8rem;">Apply DOA (reduced slabs)</span>
          </div>
        </div>
      </div>

      <label>Monthly Cloud Spend (₹)</label>
      <input type="number" id="cloudSpend" placeholder="e.g. 2000000" />

      <label>Security Services Monthly Spend (₹)</label>
      <input type="number" id="securitySpend" placeholder="e.g. 300000" />

      <label>Advanced Services Monthly Spend (₹)</label>
      <input type="number" id="advancedSpend" placeholder="e.g. 200000" />

      <div class="row">
        <div class="col">
          <label>Contract Term (Months)</label>
          <input type="number" id="termMonths" placeholder="e.g. 36" />
        </div>
        <div class="col">
          <label>Contract Term (Years)</label>
          <input type="number" id="termYears" placeholder="0 / 1 / 3" />
        </div>
      </div>

      <label>Payment Term</label>
      <select id="paymentTerm">
        <option value="Arrear">Arrear</option>
        <option value="Annual Advance">Annual Advance</option>
        <option value="Full Upfront">Full Upfront</option>
      </select>

      <button class="btn" onclick="calculate()">Calculate</button>
    </div>

    <!-- OUTPUTS -->
    <div class="right">
      <!-- View toggle -->
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <div class="toggle-group">
          <button class="toggle-btn active" id="btnInternal" onclick="setView('internal')">
            Internal View
          </button>
          <button class="toggle-btn" id="btnCustomer" onclick="setView('customer')">
            Customer View
          </button>
        </div>
        <button class="btn secondary" onclick="printCustomer()">Print Customer View</button>
      </div>

      <!-- INTERNAL VIEW CARD -->
      <div class="card" id="internalCard">
        <div class="card-header">
          Internal Summary
          <span id="doaStatusPill" class="pill secondary" style="margin-left:8px;">Standard Rate</span>
        </div>

        <table class="summary-grid">
          <tr>
            <th colspan="2">Deal Snapshot</th>
          </tr>
          <tr>
            <td class="label">Customer</td>
            <td class="value" id="outCustomer">–</td>
          </tr>
          <tr>
            <td class="label">Cloud Type</td>
            <td class="value" id="outCloudType">–</td>
          </tr>
          <tr>
            <td class="label">Plan</td>
            <td class="value" id="outPlan">–</td>
          </tr>
          <tr>
            <td class="label">Contract Term</td>
            <td class="value" id="outTerm">–</td>
          </tr>
        </table>

        <table class="summary-grid" style="margin-top:12px;">
          <tr>
            <th colspan="2">Key Commercials</th>
          </tr>
          <tr>
            <td class="label">Monthly Cloud Spend</td>
            <td class="value" id="outCloudSpend">₹0</td>
          </tr>
          <tr>
            <td class="label">Final MS MRC (Monthly)</td>
            <td class="value" id="outFinalMrc">₹0</td>
          </tr>
          <tr>
            <td class="label">Effective % of Cloud Spend</td>
            <td class="value" id="outEffectivePct">0%</td>
          </tr>
          <tr>
            <td class="label">Total Contract Value (MS)</td>
            <td class="value" id="outTcv">₹0</td>
          </tr>
        </table>

        <table class="summary-grid" style="margin-top:12px;">
          <tr>
            <th colspan="2">Detailed Breakdown</th>
          </tr>
          <tr>
            <td class="label">Net Cloud Spend (Excl. Security)</td>
            <td class="value" id="outNetCloud">₹0</td>
          </tr>
          <tr>
            <td class="label">Managed Services % (Slab + Plan + DOA)</td>
            <td class="value" id="outMsPct">0%</td>
          </tr>
          <tr>
            <td class="label">Base MS MRC (List)</td>
            <td class="value" id="outBaseMrc">₹0</td>
          </tr>
          <tr>
            <td class="label">Advanced Services MRC (List, 7%)</td>
            <td class="value" id="outAdvMrc">₹0</td>
          </tr>
          <tr>
            <td class="label">Total MS MRC (Before Term/Payment Benefits)</td>
            <td class="value" id="outTotalMrcList">₹0</td>
          </tr>
          <tr>
            <td class="label">Contract Term Discount %</td>
            <td class="value" id="outTermDisc">0%</td>
          </tr>
          <tr>
            <td class="label">Payment Term Discount %</td>
            <td class="value" id="outPayDisc">0%</td>
          </tr>
          <tr>
            <td class="label">Total Term + Payment Discount %</td>
            <td class="value" id="outTotalDisc">0%</td>
          </tr>
          <tr>
            <td class="label">Net Benefit Amount (Monthly)</td>
            <td class="value" id="outBenefitAmt">₹0</td>
          </tr>
        </table>

        <div class="note">
Internal view – includes DOA status, effective rate card and detailed breakdown for decision-making.
        </div>
      </div>

      <!-- CUSTOMER VIEW CARD -->
      <div class="card" id="customerCard" style="margin-top:12px; display:none;">
        <div class="card-header">
          Customer Commercial Summary
        </div>

        <table class="summary-grid">
          <tr>
            <th colspan="2">Deal Snapshot</th>
          </tr>
          <tr>
            <td class="label">Customer</td>
            <td class="value" id="cCustomer">–</td>
          </tr>
          <tr>
            <td class="label">Cloud Type</td>
            <td class="value" id="cCloudType">–</td>
          </tr>
          <tr>
            <td class="label">Managed Services Plan</td>
            <td class="value" id="cPlan">–</td>
          </tr>
          <tr>
            <td class="label">Contract Term</td>
            <td class="value" id="cTerm">–</td>
          </tr>
          <tr>
            <td class="label">Payment Term</td>
            <td class="value" id="cPaymentTerm">–</td>
          </tr>
        </table>

        <table class="summary-grid" style="margin-top:12px;">
          <tr>
            <th colspan="2">Key Commercials</th>
          </tr>
          <tr>
            <td class="label">Monthly Cloud Spend</td>
            <td class="value" id="cCloudSpend">₹0</td>
          </tr>
          <tr>
            <td class="label">Proposed Managed Services MRC (Monthly)</td>
            <td class="value" id="cFinalMrc">₹0</td>
          </tr>
          <tr>
            <td class="label">Total Contract Value (Managed Services)</td>
            <td class="value" id="cTcv">₹0</td>
          </tr>
          <tr>
            <td class="label">Effective Managed Services Charges (% of Cloud Spend)</td>
            <td class="value" id="cEffectivePct">0%</td>
          </tr>
        </table>

        <table class="summary-grid" style="margin-top:12px;">
          <tr>
            <th colspan="2">Commercial Structure (High Level)</th>
          </tr>
          <tr>
            <td class="label">Net Cloud Spend Considered for MS</td>
            <td class="value" id="cNetCloud">₹0</td>
          </tr>
          <tr>
            <td class="label">Managed Services Charges (before term/payment benefits)</td>
            <td class="value" id="cTotalMrcList">₹0</td>
          </tr>
          <tr>
            <td class="label">Commercial Benefits for Contract Term & Payment Terms</td>
            <td class="value" id="cBenefitAmt">₹0</td>
          </tr>
        </table>

        <div class="note">
1. Managed Services commercials are calculated on net eligible cloud spend, excluding security services.
2. Additional commercial benefits are extended based on mutually agreed contract term and payment terms.
3. All commercials are indicative and subject to final agreement and applicable taxes.
        </div>
      </div>
    </div>
  </div>

  <script>
    function num(val) {
      const n = parseFloat(val);
      return isNaN(n) ? 0 : n;
    }

    function formatCurrency(n) {
      return "₹" + n.toLocaleString("en-IN", { maximumFractionDigits: 0 });
    }

    function formatPercent(n) {
      return (n * 100).toFixed(2) + "%";
    }

    function calculateManagedServicesPercent(netCloud, plan, doa) {
      let pct = 0;
      const p = plan;

      if (!doa) {
        // Standard slabs
        if (netCloud <= 10000000) { // <= 1 Cr
          if (p === "Prime") pct = 0.15;
          else if (p === "Priority") pct = 0.20;
        } else if (netCloud <= 50000000) { // <= 5 Cr
          if (p === "Prime") pct = 0.12;
          else if (p === "Priority") pct = 0.17;
        } else { // > 5 Cr
          if (p === "Prime") pct = 0.10;
          else if (p === "Priority") pct = 0.15;
        }
      } else {
        // DOA reduced slabs
        if (netCloud <= 10000000) {
          if (p === "Prime") pct = 0.12;
          else if (p === "Priority") pct = 0.15;
        } else if (netCloud <= 50000000) {
          if (p === "Prime") pct = 0.09;
          else if (p === "Priority") pct = 0.12;
        } else {
          if (p === "Prime") pct = 0.07;
          else if (p === "Priority") pct = 0.10;
        }
      }

      if (p === "Foundation") pct = 0;
      return pct;
    }

    function calculate() {
      const customerName = document.getElementById("customerName").value || "—";
      const cloudType = document.getElementById("cloudType").value || "—";
      const plan = document.getElementById("plan").value;
      const doaApplicable = document.getElementById("doaApplicable").checked;

      const cloudSpend = num(document.getElementById("cloudSpend").value);
      const securitySpend = num(document.getElementById("securitySpend").value);
      const advancedSpend = num(document.getElementById("advancedSpend").value);

      const termMonths = num(document.getElementById("termMonths").value);
      const termYears = num(document.getElementById("termYears").value);
      const paymentTerm = document.getElementById("paymentTerm").value;

      // Core calculations
      const netCloud = Math.max(0, cloudSpend - securitySpend);
      const msPct = calculateManagedServicesPercent(netCloud, plan, doaApplicable);
      const baseMrc = netCloud * msPct;

      const advPct = 0.07;
      const advMrc = advancedSpend * advPct;

      const totalMrcList = baseMrc + advMrc;

      // Contract Term Discount %
      let termDisc = 0;
      if (termYears === 1) termDisc = 0.01;
      else if (termYears === 3) termDisc = 0.03;

      // Payment Term Discount %
      let payDisc = 0;
      if (paymentTerm === "Annual Advance") payDisc = 0.01;
      else if (paymentTerm === "Full Upfront") payDisc = 0.03;

      const totalDisc = termDisc + payDisc;
      const benefitAmount = totalMrcList * totalDisc;

      const finalMrc = totalMrcList - benefitAmount;
      const tcv = finalMrc * termMonths;
      const effectivePct = cloudSpend > 0 ? finalMrc / cloudSpend : 0;

      // INTERNAL VIEW binding
      document.getElementById("outCustomer").textContent = customerName;
      document.getElementById("outCloudType").textContent = cloudType;
      document.getElementById("outPlan").textContent = plan;
      document.getElementById("outTerm").textContent =
        (termMonths || 0) + " months" + (termYears ? " (" + termYears + " years)" : "");

      document.getElementById("outCloudSpend").textContent = formatCurrency(cloudSpend);
      document.getElementById("outFinalMrc").textContent = formatCurrency(finalMrc);
      document.getElementById("outEffectivePct").textContent = formatPercent(effectivePct);
      document.getElementById("outTcv").textContent = formatCurrency(tcv);

      document.getElementById("outNetCloud").textContent = formatCurrency(netCloud);
      document.getElementById("outMsPct").textContent = formatPercent(msPct);
      document.getElementById("outBaseMrc").textContent = formatCurrency(baseMrc);
      document.getElementById("outAdvMrc").textContent = formatCurrency(advMrc);
      document.getElementById("outTotalMrcList").textContent = formatCurrency(totalMrcList);
      document.getElementById("outTermDisc").textContent = formatPercent(termDisc);
      document.getElementById("outPayDisc").textContent = formatPercent(payDisc);
      document.getElementById("outTotalDisc").textContent = formatPercent(totalDisc);
      document.getElementById("outBenefitAmt").textContent = formatCurrency(benefitAmount);

      const pill = document.getElementById("doaStatusPill");
      if (doaApplicable) {
        pill.textContent = "DOA Rate";
        pill.className = "pill warning";
      } else {
        pill.textContent = "Standard Rate";
        pill.className = "pill secondary";
      }

      // CUSTOMER VIEW binding
      document.getElementById("cCustomer").textContent = customerName;
      document.getElementById("cCloudType").textContent = cloudType;
      document.getElementById("cPlan").textContent = plan;
      document.getElementById("cTerm").textContent =
        (termMonths || 0) + " months" + (termYears ? " (" + termYears + " years)" : "");
      document.getElementById("cPaymentTerm").textContent = paymentTerm;

      document.getElementById("cCloudSpend").textContent = formatCurrency(cloudSpend);
      document.getElementById("cFinalMrc").textContent = formatCurrency(finalMrc);
      document.getElementById("cTcv").textContent = formatCurrency(tcv);
      document.getElementById("cEffectivePct").textContent = formatPercent(effectivePct);

      document.getElementById("cNetCloud").textContent = formatCurrency(netCloud);
      document.getElementById("cTotalMrcList").textContent = formatCurrency(totalMrcList);
      document.getElementById("cBenefitAmt").textContent = formatCurrency(benefitAmount);
    }

    function setView(mode) {
      const internalCard = document.getElementById("internalCard");
      const customerCard = document.getElementById("customerCard");
      const btnInternal = document.getElementById("btnInternal");
      const btnCustomer = document.getElementById("btnCustomer");

      if (mode === "internal") {
        internalCard.style.display = "block";
        customerCard.style.display = "none";
        btnInternal.classList.add("active");
        btnCustomer.classList.remove("active");
      } else {
        internalCard.style.display = "none";
        customerCard.style.display = "block";
        btnInternal.classList.remove("active");
        btnCustomer.classList.add("active");
      }
    }

    function printCustomer() {
      // Switch to customer view before printing
      setView("customer");
      window.print();
    }

    window.onload = calculate;
  </script>
</body>
</html>
